{% extends "base.html" %}

{% block title %}Confirmation - Claim {{ claim.claim_id[:8] }}... - Reimbursement System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 mx-auto">
        <!-- Success Header -->
        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white text-center">
                <h3 class="mb-0">
                    <i class="bi bi-check-circle-fill"></i> Claim Submitted Successfully!
                </h3>
            </div>
            <div class="card-body text-center">
                <h4 class="text-success">Claim ID: <code>{{ claim.claim_id }}</code></h4>
                <p class="text-muted">Please save this Claim ID for your records.</p>
            </div>
        </div>

        <!-- Validation Status -->
        {% if not amounts_match %}
            <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle"></i>
                <strong>Note:</strong> Item totals ({{ claim.total_currency }} {{ "%.2f"|format(items_total) }}) 
                do not match the claim total ({{ claim.total_currency }} {{ "%.2f"|format(claim.total_amount) }}).
                You may want to review and edit your claim.
            </div>
        {% else %}
            <div class="alert alert-success">
                <i class="bi bi-check-circle"></i>
                <strong>Perfect!</strong> All item amounts add up correctly to the claim total.
            </div>
        {% endif %}

        <!-- Claim Summary -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-file-text"></i> Claim Summary</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-borderless">
                            <tr>
                                <th width="40%">Claim ID:</th>
                                <td><code>{{ claim.claim_id }}</code></td>
                            </tr>
                            <tr>
                                <th>Date Range:</th>
                                <td>
                                    {{ claim.from_date.strftime('%B %d, %Y') }}
                                    {% if claim.from_date != claim.to_date %}
                                        - {{ claim.to_date.strftime('%B %d, %Y') }}
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>Total Amount:</th>
                                <td class="h5 text-primary">{{ claim.total_currency }} {{ "%.2f"|format(claim.total_amount) }}</td>
                            </tr>
                            {% if claim.paid_amount and claim.paid_amount != claim.total_amount %}
                            <tr>
                                <th>Paid Amount:</th>
                                <td>{{ claim.paid_currency }} {{ "%.2f"|format(claim.paid_amount) }}</td>
                            </tr>
                            {% endif %}
                            <tr>
                                <th>Created:</th>
                                <td>{{ claim.created_at.strftime('%B %d, %Y at %I:%M %p') }}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>Business Purpose:</h6>
                        <p class="text-muted">{{ claim.business_purpose }}</p>
                        
                        <h6>Receipt:</h6>
                        <p class="text-success">
                            <i class="bi bi-file-earmark-check"></i> 
                            File uploaded successfully
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Items Summary -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-list-ul"></i> Expense Items 
                    <span class="badge bg-secondary">{{ items|length }}</span>
                </h5>
                <div>
                    <span class="text-muted">Items Total: </span>
                    <span class="h6 {% if amounts_match %}text-success{% else %}text-warning{% endif %}">
                        {{ claim.total_currency }} {{ "%.2f"|format(items_total) }}
                    </span>
                </div>
            </div>
            <div class="card-body">
                {% if items %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Description</th>
                                    <th>Amount</th>
                                    <th>Group</th>
                                    <th>Justification</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in items %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td>
                                            <strong>{{ item.description }}</strong>
                                        </td>
                                        <td>
                                            <span class="badge bg-light text-dark">
                                                {{ item.currency }} {{ "%.2f"|format(item.amount) }}
                                            </span>
                                            {% if item.paid_amount and item.paid_amount != item.amount %}
                                                <br><small class="text-muted">
                                                    Paid: {{ item.paid_currency }} {{ "%.2f"|format(item.paid_amount) }}
                                                </small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <span class="badge bg-primary">{{ item.expense_group }}</span>
                                        </td>
                                        <td>
                                            <small class="text-muted">
                                                {{ item.justification if item.justification else '-' }}
                                            </small>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <th colspan="2">Total</th>
                                    <th>
                                        <span class="{% if amounts_match %}text-success{% else %}text-warning{% endif %}">
                                            {{ claim.total_currency }} {{ "%.2f"|format(items_total) }}
                                        </span>
                                    </th>
                                    <th colspan="2"></th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-exclamation-circle fs-1 text-warning"></i>
                        <h6 class="text-warning mt-2">No Items Added</h6>
                        <p class="text-muted">This claim doesn't have any individual items yet.</p>
                        <a href="{{ url_for('add_items', claim_id=claim.claim_id) }}" class="btn btn-warning">
                            <i class="bi bi-plus-circle"></i> Add Items Now
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="card">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <div class="d-grid">
                            <a href="{{ url_for('view_claim', claim_id=claim.claim_id) }}" class="btn btn-outline-primary">
                                <i class="bi bi-eye"></i> View Details
                            </a>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="d-grid">
                            <a href="{{ url_for('edit_claim', claim_id=claim.claim_id) }}" class="btn btn-outline-secondary">
                                <i class="bi bi-pencil"></i> Edit Claim
                            </a>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="d-grid">
                            <a href="{{ url_for('add_items', claim_id=claim.claim_id) }}" class="btn btn-outline-info">
                                <i class="bi bi-plus-circle"></i> Add/Edit Items
                            </a>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="d-grid">
                            <a href="{{ url_for('new_claim') }}" class="btn btn-success">
                                <i class="bi bi-plus-square"></i> New Claim
                            </a>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="d-grid">
                            <a href="{{ url_for('claims_list') }}" class="btn btn-outline-dark">
                                <i class="bi bi-list-ul"></i> View All Claims
                            </a>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-grid">
                            <a href="{{ url_for('index') }}" class="btn btn-primary">
                                <i class="bi bi-house"></i> Back to Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Next Steps -->
        <div class="card mt-4 border-info">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0"><i class="bi bi-info-circle"></i> Next Steps</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>For Complete Claims:</h6>
                        <ul class="small">
                            <li>Generate reports for submission to finance</li>
                            <li>Export receipts for documentation</li>
                            <li>Keep the Claim ID for tracking</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>If You Need to Make Changes:</h6>
                        <ul class="small">
                            <li>Edit claim details (dates, amounts, purpose)</li>
                            <li>Add, edit, or remove individual items</li>
                            <li>Upload a different receipt if needed</li>
                        </ul>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('reports') }}" class="btn btn-info btn-sm">
                        <i class="bi bi-file-earmark-text"></i> Generate Reports
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
